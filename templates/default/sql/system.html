{% extends "layout.html" %}

{% from "macros/form_inputs.html" import
    input_submit,
    input_csrf_token,
    input_text,
    input_checkbox,
    input_textarea,
    input_radios
    with context
    %}

{% from "macros/general.html" import
        display_subnav,
        set_account_status_img,
        display_domain_cn,
        display_preferred_language,
        display_timezones,
        display_account_status,
        display_domain_backupmx,
        display_quota,
        display_input_mail
        with context
        %}

{% from "macros/msg_handlers.html" import domain_msg_handler with context %}

{% block title %}{{ _('Edit account profile') }}{% endblock %}
{% block navlinks_domains %}class="active"{% endblock %}

{% block breadcrumb %}
    {% set crumbs = [
            (ctx.homepath + '/system/settings', _('System Settings')),
            (ctx.homepath + '/system/spampolicy', _('Global Spam Policy')),
            (ctx.homepath + '/system/wblist', _('Whitelists & Blacklists')),
            (ctx.homepath + '/system/greylisting', _('Greylisting')),
            (ctx.homepath + '/system/throttle', _('Throttle')),
            ]
            %}
    {{ display_subnav(crumbs) }}
{% endblock %}

{# Domain profile. #}
{% block main %}

{# Show system message #}
{{ domain_msg_handler(msg) }}

<div class="content-box">
    <div class="box-body">
        <div class="box-wrap clear">
            {# form_type: settings #}
            <div id="form_settings" style="display: block">
                <form name="settings" method="post" action="{{ctx.homepath}}/system/settings">
                    <!--suppress ALL -->
                    {{ input_csrf_token() }}

                    <div class="columns clear">
                        <h2>Mailbox</h2>
                        <div class="rule">&nbsp;</div>
                        <div class="col2-3">
                            {{ input_radios(input_name='mailbox_format',
                                label=_('Default mailbox format'),
                                options=[('maildir', _('Maildir (One message per file). Recommended.')),
                                         ('mdbox', _('Mdbox (Multiple messages per file)'))],
                                enable_input=false) }}
                            {{ input_text(input_name='mailbox_folder',
                                label=_('Default mailbox folder'),
                                comment=_('Only letters (case sensitive) and digits are allowed, max 20 chars'),
                                enable_input=false) }}
                        </div>
                        <div class="col1-3 lastcol">
                            <div class="mark_blue bt-space10">
                                <ul class="standard clean-padding bt-space10">
                                    <li>It affects newly created mailboxes, not existing ones.</li>
                                    <li>Maildir is easy to migrate, backup and restore.</li>
                                    <li>Mdbox has better performance, but corrupted/lost index files will cause data lose and can not be recovered.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="columns clear">
                        <h2>Password</h2>
                        <div class="rule">&nbsp;</div>
                        <div class="col2-3">
                            {{ input_text(input_name='min_passwd_length',
                                label=_('Minimum password length'),
                                size=4, enable_input=false) }}
                            {{ input_text(input_name='max_passwd_length',
                                label=_('Maximum password length'),
                                size=4, enable_input=false) }}
                            {{ input_checkbox(input_name='password_has_letter',
                                label=_('Require at least one letter'),
                                enable_input=false) }}
                            {{ input_checkbox(input_name='password_has_uppercase',
                                label=_('Require at least one uppercase letter'),
                                enable_input=false) }}
                            {{ input_checkbox(input_name='password_has_number',
                                label=_('Require at least one number'),
                                enable_input=false) }}
                            {{ input_checkbox(input_name='password_has_special_char',
                                label=_('Require at least one special character'),
                                enable_input=false) }}
                        </div>
                    </div>
                    <div class="columns clear">
                        <h2>Login Restrictions</h2>
                        <div class="rule">&nbsp;</div>
                        <div class="col2-3">
                            {{ input_textarea(input_name='admin_login_ip_list',
                                label=_('All admins can only login from specified IP addresses or networks'),
                                comment=_('One IP address or network per line. Invalid address or network will be discarded.'),
                                rows=4, cols='50%', enable_input=false) }}
                            {{ input_textarea(input_name='global_admin_ip_list',
                                label=_('Global admin can only login from specified IP addresses or networks'),
                                comment=_('One IP address or network per line. Invalid address or network will be discarded.'),
                                rows=4, cols='50%', enable_input=false) }}
                            {{input_textarea(input_name='restful_api_clients',
                                label=_('RESTful API is accessible only from specified IP addresses or networks'),
                                comment=_('One IP address or network per line. Invalid address or network will be discarded.'),
                                rows=4, cols='50%', enable_input=false) }}
                        </div>
                    </div>
                    <div class="columns clear">
                        <h2>Data Clean Up</h2>
                        <div class="rule">&nbsp;</div>
                        <div class="col2-3">
                            {{ input_text(input_name='amavisd_remove_maillog_in_days',
                                label=_('Remove log of inbound/outbound mails older than'),
                                comment=_('Days'), comment_as_label=true,
                                size=4, enable_input=false) }}
                            {{ input_text(input_name='amavisd_remove_quarantine_in_days',
                                label=_('Remove quarantined mails older than'),
                                comment=_('Days'), comment_as_label=true,
                                size=4, enable_input=false) }}
                        </div>
                    </div>
                    {{ input_submit() }}
                </form>
            </div>

            {# form_type: domain_ownership #}
            <div id="form_domain_ownership" style="display: block">
                <form name="form_ownership" method="post" action="{{ctx.homepath}}/system/domain_ownership">
                    <!--suppress ALL -->
                    {{ input_csrf_token() }}
                    <div class="columns clear">
                        <h2>Domain ownership verfication</h2>
                        <div class="rule">&nbsp;</div>
                        <p>Please verify mail domains listed below, to ensure
                            that it is an valid domain and you have the required
                            privileges in the domain to manage the email services.
                            Mail services are disabled for pending domains, and
                            will be enabled automatically after verified.</p>
                        <p>To verify domain ownership, please choose one of methods listed below:</p>
                        <ul class="standard clean-padding bt-space20">
                            <li>Create a text file under top directory of your web site, both file name and file content must be same as verify code</li>
                            <li>Create a TXT type DNS record of the domain name, use the verify code as its value</li>
                        </ul>
                        <form id="form_domain_ownership" method="post" action="/verify/domain_ownership">
                            <table class="style1">
                                <thead>
                                    <tr>
                                        <th class="checkbox">
                                            <input class="checkbox select-all" type="checkbox">
                                        </th>
                                        <th>Domain</th>
                                        <th style="wiite-space: nowrap;">Verify code</th>
                                        <th>Admin</th>
                                        <th>Last verify status</th>
                                        <th>Last verify time</th>
                                    </tr>
                                </thead>
                            </table>
                        </form>
                    </div>
                </form>
            </div>

            {# form_type: spampolicy #}
            <div id="form_spampolicy" style="display: block">
                <form name="form_spampolicy" method="post" action="{{ctx.homepath}}/system/spampolicy">
                    <!--suppress ALL -->
                    {{ input_csrf_token() }}
                    <div class="notification note-info">
                        <p><i class="fa fa-info fa-lg fa-fw"> Account does not have specific spam policy yet, server-wide policy will be applied.</i></p>
                    </div>
                    <div class="columns clear">
                        <div class="col2-3">
                            {{ input_checkbox(input_name='enable_spam_checks',
                                label=_('Spam checking'),
                                comment=_('Enable spam checking'),
                                enable_input=false) }}
                            {{ input_checkbox(input_name='spam_quarantine_to',
                                label=_(' '),
                                comment=_('Quarantine spam'),
                                enable_input=false) }}
                            {{ input_checkbox(input_name='enable_virus_checking',
                                label=_('Virus checking'),
                                comment=_('Enable virus checking'),
                                enable_input=false) }}
                            {{ input_checkbox(input_name='virus_quarantine_to',
                                label=_(' '),
                                comment=_('Quarantine virus'),
                                enable_input=false) }}
                            {{ input_checkbox(input_name='enable_header_checks',
                                label=_('Bad-header checking'),
                                comment=_('Enable bad-header checking'),
                                enable_input=false) }}
                            {{ input_checkbox(input_name='bad_header_quarantine_to',
                                label=_(' '),
                                comment=_('Quarantine bad-header email'),
                                enable_input=false) }}
                            {{ input_checkbox(input_name='enable_banned_checks',
                                label=_('Banned file type checking'),
                                comment=_('Enable banned file type checking'),
                                enable_input=false) }}
                            {{ input_checkbox(input_name='banned_quarantine_to',
                                label=_(' '),
                                comment=_('Quarantine email which contains banned file types'),
                                enable_input=false) }}
                        </div>
                        <div class="rule">&nbsp;</div>
                        <div class="col2-3">
                            {{ input_checkbox(input_name='modify_spam_subject',
                                label=_('Prefix text [SPAM] to subject of spam'),
                                enable_input=false) }}
                            {{ input_text(input_name='spam_tag2_level',
                                label=_('Mark mail as spam when score is'),
                                comment=_('Default is 6'),
                                comment_as_label=true, enable_input=false) }}
                            {{ input_text(input_name='spam_kill_level',
                                label=_('Block or quarantine marked spam when score is >='),
                                comment=_('Default is 6.9'),
                                comment_as_label=true, enable_input=false) }}
                            {{ input_checkbox(input_name='always_insert_x_spam_headers',
                                label=_('Always insert X-Spam-* headers'),
                                enable_input=false) }}
                        </div>
                        <div class="col1-3 lascol">
                            <div class="mark_blue bt-space10">
                                <ul class="standard clean-padding bt-space10">
                                    <li class="bt-space5">If many clean mails were marked as spam, please slightly increase the score.</li>
                                    <li class="bt-space5">If many spam message were not classified, please slightly decrease the score.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                {{ input_submit() }}
            </form>
        </div><!-- .box-wrap -->
    </div><!-- .box-body -->
</div><!-- .content-box -->
{% endblock main %}

{% block extra_js %}
<script type="text/javascript">
$(document).ready(function() {
    $(".tabs li").idTabs("form_{{ profile_type }}")
});
</script>
{% endblock extra_js %}
